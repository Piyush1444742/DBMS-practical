-- Main Library table
CREATE TABLE Library (
    BookID     NUMBER PRIMARY KEY,
    BookName   VARCHAR2(100),
    Author     VARCHAR2(50),
    Quantity   NUMBER
);

-- Audit table to store old values
CREATE TABLE Library_Audit (
    AuditID    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BookID     NUMBER,
    BookName   VARCHAR2(100),
    Author     VARCHAR2(50),
    Quantity   NUMBER,
    ActionType VARCHAR2(10),  -- 'UPDATE' or 'DELETE'
    ActionDate DATE
);
-- Row-level trigger for UPDATE and DELETE
CREATE OR REPLACE TRIGGER trg_library_audit
BEFORE UPDATE OR DELETE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit(
        BookID,
        BookName,
        Author,
        Quantity,
        ActionType,
        ActionDate
    )
    VALUES (
        :OLD.BookID,
        :OLD.BookName,
        :OLD.Author,
        :OLD.Quantity,
        CASE 
            WHEN UPDATING THEN 'UPDATE'
            WHEN DELETING THEN 'DELETE'
        END,
        SYSDATE
    );
END;
/
